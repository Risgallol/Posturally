<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Posturally</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header class="app-header-stripe">
      <div class="title-wrap">
        <h1 class="app-title">
          <span class="brand">Posturally</span>
          <span class="divider">—</span>
          <em class="descriptor">Smart Posture Monitoring</em>
        </h1>
        <p class="app-subtitle">
          All-local posture & direction monitoring — no uploads
        </p>

          <div class="header-actions">
          <!-- Primary CTA: guides users to start -->
          <button id="helpButton"
                  type="button"
                  class="badge"
                  aria-label="Quick start">
            Quick Start
          </button>

          <!-- Secondary: Contact form (uses the modal you added) -->
          <button id="contactButton"
                  type="button"
                  class="badge ghost"
                  aria-label="Open contact form">
            Contact
          </button>
        </div>

      </div>
    </header>




    <div class="panel video-wrap">
      <video id="cam" autoplay playsinline></video>
      <canvas id="overlay"></canvas>
    </div>

    <div class="controls">
      <!-- Three buttons in one row -->
      <div class="button-row">
        <button id="cameraToggle">Start Camera</button>
        <button id="calibrate">Calibrate</button>
        <button id="statusPip">Keep active</button>
      </div>

      <!-- Sensitivity (slider replaces Index threshold) -->
      <label class="inline row-full sensitivity-block">
        Sensitivity
        <div class="slider-scale">
          <span class="scale-label">Low</span>
          <div class="slider-wrap">
            <input id="sensitivity" type="range" min="0" max="100" value="40" step="1" />
            <!-- Tick marks -->
            <div class="scale-ticks">
              <span></span><span></span><span></span><span></span><span></span>
            </div>
            <!-- Tooltip -->
            <div id="sensTip" class="slider-tooltip" role="status" aria-live="polite">40%</div>
          </div>
          <span class="scale-label">High</span>
        </div>
      </label>
      <!-- Hidden input for backward compatibility -->
      <input id="ratio" type="hidden" value="1.20">

      <!-- Timers card with Beep in the corner -->
      <div class="timers-card row-full">
        <div class="timers-header">
          <span class="timers-title">Timers (seconds)</span>

          <!-- Compact Beep toggle -->
          <label class="beep-toggle" title="Sound a short beep on alerts">
            <input type="checkbox" id="beep" checked>
            <span>Beep alert</span>
          </label>
        </div>

        <div class="timers-grid">
          <div class="timer-box">
            <label for="hold">Slouch</label>
            <input id="hold" type="number" step="1" min="5" max="300" value="30">
          </div>

          <div class="timer-box">
            <label for="yawHold">Head Direction</label>
            <input id="yawHold" type="number" step="1" min="5" max="300" value="30">
          </div>
        </div>
      </div>


<!-- Status panel -->
<div class="status-panel panel">
  <!-- Top line: dynamic status message (neutral text) -->
  <div id="statusMsg" class="status-instruction">
    Camera is off — click <b>Start Camera</b> to begin.
  </div>

  <!-- Second row: two side-by-side boxes -->
  <div class="status-row">
    <div id="postureMsg" class="status-strong status-box">Posture: —  —  Score: —</div>
    <div id="directionMsg" class="status-strong status-box">Direction: —</div>
  </div>
</div>


  <!-- Hidden video used to carry the status-only canvas into PiP -->
  <video id="pipVideo" playsinline muted style="display:none;"></video>

  <!-- Slider → threshold script -->
<script>
  // Mapping: slider 0..100 => threshold THRESH_MAX..THRESH_MIN (inverse)
  const THRESH_MIN = 1.05; // most sensitive
  const THRESH_MAX = 1.50; // least sensitive

  const sensEl = document.getElementById('sensitivity');
  const hiddenRatio = document.getElementById('ratio');
  const tipEl = document.getElementById('sensTip');

  function sliderToThreshold(v) {
    return THRESH_MAX - (v / 100) * (THRESH_MAX - THRESH_MIN);
  }

  // Position tooltip as a percentage inside .slider-wrap
  function updateTooltipPosition() {
    const min = Number(sensEl.min) || 0;
    const max = Number(sensEl.max) || 100;
    const val = Number(sensEl.value);
    const pct = (val - min) / (max - min); // 0..1

    // Move by % of the track; center visually with translateX(-50%)
    tipEl.style.left = `${pct * 100}%`;
    tipEl.style.transform = `translateX(-50%)`;
    tipEl.textContent = `${Math.round(val)}%`;
  }

  function updateThreshold() {
    const precise = sliderToThreshold(Number(sensEl.value));
    hiddenRatio.value = precise.toFixed(4);
    hiddenRatio.dispatchEvent(new Event('change', { bubbles: true }));
    tipEl.style.opacity = '1';           // keep visible during drag
    updateTooltipPosition();
  }

  function showTip()  { tipEl.style.opacity = '1'; updateTooltipPosition(); }
  function hideTip()  { tipEl.style.opacity = '0'; }

  // Init + listeners
  updateThreshold();
  sensEl.addEventListener('input',  updateThreshold);
  sensEl.addEventListener('change', updateThreshold);

  // Mouse
  sensEl.addEventListener('mouseenter', showTip);
  sensEl.addEventListener('mouseleave', hideTip);
  sensEl.addEventListener('mousedown', showTip);
  window.addEventListener('mouseup',  hideTip);

  // Touch
  sensEl.addEventListener('touchstart', showTip,   { passive: true });
  sensEl.addEventListener('touchend',   hideTip,   { passive: true });
  sensEl.addEventListener('touchcancel', hideTip,  { passive: true });

  // Keep aligned on resize
  window.addEventListener('resize', updateTooltipPosition);
</script>



  <!-- Existing app script -->
  <script type="module" src="script.js"></script>

  <!-- Non-Chromium browser guard for Keep Active (classic script for Safari) -->
  <script src="pip-compat.js" defer></script>

  <!-- Onboarding tutorial script -->
  <script type="module" src="onboarding.js"></script>


<!-- Contact Modal -->
<div id="contactModal" class="onb-overlay">
  <div class="onb-panel" data-ready="1">
    <h2 class="onb-title">Share your feedback</h2>
    <p class="onb-body">
      This is an early version of Posturally. We’d love your thoughts to help us improve!
    </p>

    <form id="contactForm" action="https://formspree.io/f/mandnqbk" method="POST" class="space-y-3">
      <input type="hidden" name="_subject" value="New feedback from Posturally">

      <label class="inline row-full">
        Name
        <input type="text" name="name" placeholder="Your name (optional)" >
      </label>

      <label class="inline row-full">
        Email
        <input type="email" name="email" placeholder="you@example.com (optional)">
      </label>

      <label class="inline row-full">
        Feedback
        <textarea name="message" rows="4" placeholder="Tell us what worked, what didn’t, or any ideas…" required></textarea>
      </label>

      <div class="onb-actions">
        <button type="button" id="contactCancel" class="onb-btn">Cancel</button>
        <button type="submit" class="onb-btn primary">Send Feedback</button>
      </div>
    </form>
  </div>
</div>


</body>
</html>
